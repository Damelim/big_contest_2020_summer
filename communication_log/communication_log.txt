*** 앞으로 여기에 각자 무엇을 했는지 시간순으로 상세히 적으면 편할 것이라 생각함 ***

*** 본인 앞의 과정들은 내가 매우 자세히 적어 놓았음 ***

Aug 4, 2020 15:00~ 17:00 전체 회의

- 삭제, 추가할 변수들 의논

- 팀의 잔여 타율 방어율 승률을 한번에 예측 X. 가령 Nexen을 예측한다 하자. 잔여 경기가 A팀이랑 3번, B팀이랑 4번, C팀이랑 5번 있다고 치자.
4조의 접근 방식은 A A A B B B B C C C C C 각 경기를 예측하는 것이 아니라 12경기를 aggregate 한 98이닝짜리 하나 시합을 예측한다.
이 때 선수들 개개인이 98이닝 동안 어떤 performance를 보일지 예측하는 것이다.

98이닝 동안의 타율, 방어율은 공식대로 나온다. 
승률은 Pythagorian ~~로 보정하여 구한다.

- 개인 > 팀의 이유는:

1) 2016~20동안 팀의 성적(대표적인 순위 변동을 그래프로 inspect)이 매우 크게 변한다. 그러나 선수의 성적은 이보다 변동성이 적다.

4조 조원 모두가 생각해 볼 반박 Q) 팀의 성적은 선수 성적으로 이루어진 것 아닌가? 어떻게 팀 성적은 급변, 개인 성적은 그래도 stable?
내가 생각한 반박에 대한 defense A) 한 팀을 구성하는 많은 선수들의 시즌별 성적 변동 요소가 모여 팀 성적의 변동이 나오게 된 것이다.
                                                눈덩어리가 불어났다.

2) 야구는 play와 play 간의 독립성이 큰 스포츠이다. 팀 동료들의 성적이 개인의 성적에 미치는 영향이 (방어율 / 타율에서는) 비교적 작다.

**동료 선수들 실력이 좋으면 base에 사람들 많이 나가서 point가 많이 생기는 거 아냐? 에 대한 defense logic 필요**











Aug 5, 2020 14:00 조유림 학회원

EDA.ipynb

1) 타자 / 투수 연도별 데이터 concat 및 변수삭제

2) 개인타자 관련 변수 추가 
AVG  타율
OBP 출루율
SB_trial : stolen base trial
SB_SR : stolen base success rate

3) 개인투수 관련 변수 추가

ERA : 방어율

4) 영어 이름으로 저장 (앞으로 이 이름으로 통일하기로 암묵적 합의가 있는 것으로 개인적으로 생각함)












Aug 5, 2020 21:30 홍익선 학회원

EDA_hong.ipynb

1) concatenation -> 완료된 상태

2) NA check

- 연봉 : 벤헤켄 한 명 na인데 연봉은 빼기로 했음


3) 파생변수 추가 : 추가된 데이터가 코드에는 있으나 데이터에는 반영이 되지 않았는데, 뒤의 임선우 학회원이 반영함.












Aug 5, 2020 23:30~03:00 임선우 학회원

1) 앞에까지 회원들이 한 일들과 앞으로 나 이후로 할 일들의 travel log(이 메모장같은거)이 있었으면 하여 travel_log 파일을 세세하게 작성. 

2) 조유림 학회원의 영어이름으로 바뀐 파일, eda로 만들어진 파일들이 eda_code 파일에 들어가 있었는데, 그 파일을 "eda_data"파일로 옮겼다

3) modeling_code라는 폴더에 7월 31일 제출한 제주 dacon 대회에서 내가 만든 최종 모델 코드를 담았다. 
Random Forest regression, adaboost regression, light gradient boosting regression 3개를 후보로 한 Voting Regression에 대한 코드이다.
참조하거나 안하거나. 나중에 모델링 과정에서 마음대로 하면 될 것이다.

4) 시즌별 팀의 성적 순위 편차가 매우 크다는 TIME SERIES PLOT (R로 그림). PPT에 "개인별 모델링을 한 이유"라는 항목에 집어넣음 좋을 것이다. 

citing : https://ko.wikipedia.org/wiki/KBO_리그_연도별_팀_순위#2010년대

주의: 4)는 모델링과 직접적으로 연관성이 없다. 단지 ppt에 담으면 좋을 그림일 뿐이다. 왜 개인별 접근을 하였는가?에 대한 이유 중 하나일 뿐임

html : pointer가 구현될 수 있으며 2015.5, 2016.5 등등 원하지 않는 x축 값들이 있는데 이건 화면을 축소하면 된다
png : pointer가 구현될 수 없다.

5) 홍익선 학회원의 타자 파생변수를 column 추가. 투수는 추가 파생변수가 없었음.

6) HEATMAP을 그리기 위한 타율, 방어율을 설명할 수치형 설명변수 뽑기

**여기서 난제 : 타율을 예측할 때 타수, 안타 수, 2루타 수, 3루타 수, 홈런 수, 장타율 같은 것들이 들어갈 수 있는가?**

타율은 타수, 안타수, 2루타수, 홈런수의 mathematical function이다! 이것은 곧 bmi를 예측하기 위해서 키와 몸무게를 다 넣는 것과 같다고 할까?

한 마디로 다중공선성이 극심할 것이라는 것이다.

일단 지금은 생각만 해놓고 웬만한 변수들은 넣어 놓았다. 나중에 협의한 다음 뺄 수도 있겠다.

투수도 마찬가지다.

6) HEATMAP 그리기!

6-1) 타자 변수의 heatmap 생성. 이 heat맵은 X변수들끼리 상관관계 (선형이기는 하지만!)에 대한 insight 제공
6-2) 투수 변수의 heatmap 생성. 이 heat맵은 X변수들끼리 상관관계 (선형이기는 하지만!)에 대한 insight 제공

6-3) 독립변수들끼리 매우 상관관계가 높은 것들이 있을 때, 그들 중 어떤 것을 빼는 것을 제안. 
내가 제안하는 빼면 좋겠을 변수의 기준은 *다른* X변수들과 연관성이 큰 것들이다.

가령, X1,X2, ...,X25까지 독립변수들의 pool이라 하고 X1,X2 둘 간의 상관관계가 크다고 하자.
만약 X1은 X3~X25와의 상관성이 적은 반면, X2는 X3~25와 상관성이 크다면 X2를 삭제하는 것이 나을 것이라는 IDEA

7) 임선우 학회원이 던지는 개인적인 질문 :  7-2)가 매우 중요하다 개인적으로 생각.

7-1) 확실히 한 선수의 한 경기 성과를 row로 구성하면 row 하나씩은 x변수들과 y변수들 모두 매우 불안정한 수치가 된다. 이 현상은 괜찮은 것인가? 괜찮지 않다면 어떠한 접근을 택해야 할 것인가?
가령, 타율은 가령 0,0.5,0.333,0.666,0.75 같은 숫자들, 방어율은 0,1, 1.5,3,4.5 9, 18, 27, 81 등등으로 스텝 변수가 되어버림.
 
7-2) 타율을 예측하는 설명변수로 타수, 안타 수, 2루타 수, 3루타 수, 홈런 수, 장타율 같은 것들이 들어갈 수 있는가?

      이것들을 넣는 것은 BMI를 예측할 때 설명변수로 키와 몸무게를 다 넣는 것과 똑같은 것이 아닌가?

진짜 쉬운 설명으로, Y를 예측하기 위해 두가지 설명변수를 X1 = X, X2 = Y-X로 넣는것과 똑같은 거다...


8) 새로 변경된 개인타자 데이터를 private_batter_add_variable.csv로 저장. 왜 이렇게 했는지는 코드에서 설명.











Aug 7, 15~16:30 전체회의

------- 기각된 후보 의견 -------------

<아예 흔히 아는 머신러닝이 아닌 방식>

1) 베이즈 + 시뮬레이션

2) 시계열 (자기 팀 AND 상대팀 : 90개, 자기팀만 : 10개)


< 기존의 머신러닝 방식이되 이 접근은 채택되지 않음>

연봉, 연봉 변화율을 안타, 방어율을 설명할 변수로 쓴다 



------ 기존의 머신러닝 방식으로 간다. ---------------

팀을 통째로 예측하는 방식  n명 VS 개인들별 예측한 다음 가중합 방식 5-n명 수행. 

이후 validation error (cross validation이 가능하면 더욱 좋겠음. row 수를 볼 때 가능할 연산량으로 보임.)



----------- 설명변수 합의한 사항과 그 이유 --------------------


*** 우리는 독립변수라는 의미상 예측하려는 목적의 종속변수와 의미상 관련이 있는! 변수들을 독립변수로 1차적으로 고려하였다***

*** 그러나! 종속변수 자체! 그리고 종속변수 요소를 알아야지만 알 수 있는 변수를 독립변수를 쓸 수는 없다!
가령 타율을 예측할 때, 안타가 설명변수로 들어가면 당연히 안되는 것이며, 타율 = (1,2,3,4루타 / 타수)인데 이를 선형변환한 유사지표 가령 장타율 (<1루타,2루타,3루타,4루타> <1,2,3,4> / 타수)도 쓰면 안된다.

종속변수를 독립변수로 쓰는 게 말이 안되기 때문이다. 이것은 순환논리

우리가 합의한 설명변수들과 이유를 밑에 정리하였다.



Aug 7, 18:00  임선우 학회원


투수

1)설명변수, 종속변수 둘 다 아닌것 : 

GDAY_DS (기온, 시즌초,말 등의 요소가 게임연월일에 있으며 선수 연령이 이 변수랑 간접적으로 연결되는데 우리는 이것은 고려하지 않기로 했다. (2020년에 더욱 큰 가중치를 주는 것은 하나의 이유)
T_ID (내가 무슨팀인지, 내 동료들이 어떤지는 방어율과 연관성이 거의 없다고 본다.)
VS_T_ID (상대팀이 무엇인지는 내 팀이 무엇인지보다는 관련성이 있으나 이보다 단지 홈/원정을 나눌 TB_SC로 쓰기로 함. TB_SC는 초/말인데 그것이 홈/원정을 나타내는 지표이다.
P_ID (레벨이 무지무지 많다)
BB (볼넷, 고의사구, 맞는볼 등을 따로 고려 안하고 PA-AB라는 지표로 볼넷, 고의사구, 맞는볼 등을 종합적으로 고려)
R (종속변수랑 거의 똑같은데 미묘하게 다름. 어쨌든 종속변수랑 의미상 거의 동일)

2) 종속변수여서 설명변수가 아닌 것 :

ER (종속변수의 분자)
ERA (종속변수 자체)

3) 설명변수로 그대로 쓰이는 것:

TB_SC (홈, 원정에 따른 심리적 요소)
INN2 (종속변수의 분모에 쓰이는 거 아냐?라고 질문 가능. 맞아. 그러나 종속변수의 분자인 "자책점"과는 달리 이거는 종속변수랑 의미가 겹치는 지표가 아니며 두 변수의 연관성에 대한 "가설"을 세울 수 있다. 
가령, 이닝이 늘어날수록 투수가 감이 풀려서 자책점 증가 속도가 이닝 증가 속도보다 느릴까? vs 이닝이 늘어날수록 투수가 지치고 타자가 적응하여 자책점 증가속도가 이닝증가속도보다 빠를까 등의 가설이다.)
BF (투구수. INN2,AB와 유사한 배경으로 독립변수로 쓰며, INN2,AB변수와 상관성을 보고 나서 판단. EDA단계에서는 고려 가능하다 판단.)
AB (상대한 타석수. INN2, BF와 유사한 배경으로 독립변수로 쓰며, INN2,BF 등과 상관성을 보고 판단. EDA단계에서는 고려 가능하다 판단.)
HIT (타율 예측과는 달리 방어율과 직접적으로 의미가 겹치지 않는다)
H2 (타율 예측과는 달리 방어율과 직접적으로 의미가 겹치지 않는다)
H3 (타율 예측과는 달리 방어율과 직접적으로 의미가 겹치지 않는다)
HR (타율 예측과는 달리 방어율과 직접적으로 의미가 겹치지 않는다)
KK (삼진을 잘 잡는 투수는 실력이 좋고 실점 억제력이 높지 않을까 하는 의미 삼진은 실점을 억제하는 가장 좋은 방식!)
WP (폭투는 오히려 제구력이 안 좋은 선수가 아닌가 하는 의미)

4) 융합해서 하나로 만들거나 변수의 개념을 수정 :
PA -> (PA-AB)로 수정. PA-AB는 투수가 볼넷, 고의사구, 몸에맞는볼을 얼마나 내주었는지를 말함. 이는 자책점과 충분히 관련성이 있다고 직관적 생각됨.)
SB, CS ->  SB/(SB+CS)로 융합지표.      


타자

1) 설명변수, 종속변수 둘 다 아닌것 : 

GDAY_DS (기온, 시즌초,말 등의 요소가 게임연월일에 있으며 선수 연령이 이 변수랑 간접적으로 연결되는데 우리는 이것은 고려하지 않기로 했다. (2020년에 더욱 큰 가중치를 주는 것은 하나의 이유)
T_ID  (내가 어떤 팀에 있는지는 타율과 연관성이 있을까? 없다)
VS_T_ID (단지 홈/원정을 나눌 TB_SC로 쓰기로 함. TB_SC는 초/말인데 그것이 홈/원정을 나타내는 지표이다.
P_ID (레벨이 무지무지 많다)
H2  (분자 구성 요소로 직접 들어감. 이거는 따지자면 예측의 대상이라고도 할 수 있음)
H3 (분자 구성 요소로 직접 들어감. 이거는 따지자면 예측의 대상이라고도 할 수 있음)
HR (분자 구성 요소로 직접 들어감. 이거는 따지자면 예측의 대상이라고도 할 수 있음)
SB (도루를 많이 하는 거는 출루를 많이 하는 것과 연관성이 있다. 하지만 왜 안썼냐면 도루 시도를 썼기 때문. 도루 시도 수가 도루 성공개수보다 출루실력과 관련있음.
CS (SB 안 쓴 이유와 같이 SB, CS 둘 다 안쓰며 대신 SB+CS인 SB_TRIAL을 쓴다)
BB (BB, IB, HP를 종합적으로 고려한 PA-AB하나만을 쓴다)
IB (BB, IB, HP를 종합적으로 고려한 PA-AB하나만을 쓴다)
HP (BB, IB, HP를 종합적으로 고려한 PA-AB하나만을 쓴다)
GD (병살타와 안타는 타격 실력보다 운과 관련성이 크다고 본다.)
ERR (상대실책은 상대편의 수비실력이지 타자의 BATTING 실력이 아니다)
LOB (잔루는 내 역량은 별로 중요하지 않고 동료들의 역량이 중요하다.)
OBP (이것은 종속변수를 가공한 지표)
SB_SR (도루 성공률은 주력이다. 그 대신 출루실력과 관련있는 SB_TRIAL을 쓴다)


2) 종속변수여서 설명변수가 아닌 것 :

HIT (분자. HIT은 1루타만을 말하는 것이 아니라 1,2,3,4루타 모두를 말하는 것이다)
AVG (그 자체)

3) 설명변수 그대로

TB_SC (홈, 원정에 따른 심리적 요소)
AB (투수에서의 INN2와 대응)
RBI (타점. 안타 실력과 관련 있다 판단. 타점을 내는 방식은 꼭 자신의 안타만이 아니기 때문에 의미가 겹치지 않다고 생각함.)
RUN (득점. 안타 실력과 관련성이 있다 판단. 그러나 득점을 내는 방식은 꼭 안타로 인한 출루만이 아니므로 의미가 겹치지 않다고 생각함)
KK (안타치는 실력의 부족이라 판단)
SB_TRIAL (위에서 설명한 바와 같이 출루실력과 관련있고 출루실력은 안타실력과 관련있음. 의미적 연관성이 다단계이지만 EDA단계에서 고려할 가치가 있다고 판단)


4) 융합해서 하나로 만들거나 변수의 개념을 수정 :

SH, SF를 합쳐서 SH+SF = Sacrifice  (희생타를 치려면 공을 원하는 방식으로 치는 실력이 필요하다 생각. 다만, 그 방식이 FLY BALL을 날리는건지, 땅볼을 치는 것인지 구별은 중요하지 않다 판단해 

PA를 변경해서 PA-AB  (볼넷, 고의사구, 맞는볼 등을 따로 고려 안하고 PA-AB라는 지표로 볼넷, 고의사구, 맞는볼 등을 종합적으로 고려)


---------------------------------------------------------------------------------------


Aug ,        , 조유림 학회원

팀,개인   타자 , 투수 파일을 합의한 변수대로 변형. 








Aug  ,           , 홍익선 학회원

x,y변수가 다 있는 correlation plot과 y변수에 대한 density로 bell shaped ? skewness ? 판단.




AUG 19 권혁 , 조유림 학회원

파생변수 추가 , X변수의 예측. (한경기로 통째로 합침)












AUG 20~21 임선우학회원

1. 한 일

1-1) 여기는 예측된 X값이 없다는 점에 유의하여야 한다. 예측된 X값들은 코드 내에 있었다. 그 코드 끝에 to_csv 해서 test X 파일 2개(투 / 타)를 만들었다.
1-2) 권혁, 조유림 학회원의 작업을 물려받아 (수정 하나도 없음) train data에서 투 / 타 각각 light GBM, XGBoost 학습.
---> 21 새벽까지는 타자 lightGBM은 돌리지 못했다. 타자 xgboost가 무지무지 오래걸린다. 물론 parameter를 고정하면 모델 5,6개씩 학습가능한데 각각 모델에 grid search가 들어가서 무지 오래걸리게 된다. 
어떻게 보면 grid search 안의 후보 parameter가 달라짐에 따라 모델도 달라지므로 고려한 모델은 
lgbm : 180 (투수)
xgboost : 108 + 108 (타자, 투수)

총 396개라고 할 수도 있겠다.


1-3) 각 모델에서의 feature importance plot 그리기 -> PPT에 넣어도 될 듯하다 (FEATURE IMPORANCE의 정의를 한 번 되새겨볼 필요는 있다)
1-4) 만든 폴더들 (안에 투수, 타자 각각 하나씩 파일 있음)
* modeling_code/test_data : 조유림 학회원이 가공한 private_batter, private pitcher의 (예측된) X test data를 code along -> to_csv하였다
* modeling_code/report_data : test data와의 차이점을 두려고 하였다. test 데이터는 test X만 있는 데이터, report data는 report 라는 뜻 그 자체로 대회주최측에 보고할 예측 y까지 있는 제출파일. 
  




2. 고려할 점, 질문거리

Q1)이닝수, 타수로 수치형데이터 (엄밀히 말하면 수치형 변수 중에서 이닝당,한 타수 당이라는 의미로 이닝수로 나눌 수 있는 것)를 나누어서 한 이닝 당 안타수, 자책점 수를 예측하고 거기에다가 이닝을 곱한 것을 예측치로 할까?
A1) 그러기보다는 이닝, 타수 모두 설명변수로 취급하면 추가적인 아이디어를 얻을 희망도 있으며 TREE 기반 METHOD의 FEATURE IMPORTANCE를 맹신하면 안 되겠으나 이닝 수, 타석 수가 지배적인 FEATURE가 아니기도 하였다고 보임.

Q2) feature importance의 엄밀한 의미에 대해 고민해보기. 인과관계? 상관관계? 상위 node를 가르는 기준? 그림 가지고 발표할 때 설명이 정확해야 함.


모델링할 때 전제 : 안타수 (HIT), 자책점수 (ER)이 예측의 대상이다. AVG, ERA는 모델링할 때는 고려말자. 예측된 안타, 자책점과 input으로 있는 (예측된) 타수, 이닝으로 보고할때 타율 / 방어율로 하자.









